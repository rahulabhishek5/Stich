<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Attendance QR Generator</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-white text-black">
    <div class="flex flex-col min-h-screen">
        <header class="flex justify-end items-center px-6 py-4">
            <div class="flex items-center gap-4">
                <span class="font-medium">John Teacher</span>
                <span class="material-symbols-outlined text-3xl">account_circle</span>
                <button class="bg-black text-white px-4 py-2 rounded-md text-sm font-medium">Logout</button>
            </div>
        </header>
        <main class="flex-grow flex items-start justify-center p-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 w-full max-w-7xl">
                <div class="flex flex-col">
                    <h2 class="text-2xl font-bold mb-6">Generate Attendance QR</h2>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700" for="class-code">Class Code</label>
                            <input
                                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-black focus:border-black sm:text-sm"
                                id="class-code" type="text" value="MATH101" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Current Location</label>
                            <div class="mt-1 p-3 border border-gray-300 rounded-md bg-gray-50 text-sm text-gray-600">
                                <p>Latitude: 40.7128</p>
                                <p>Longitude: -74.0060</p>
                            </div>
                        </div>
                        <button
                            class="w-full bg-black text-white font-bold py-3 px-4 rounded-md hover:bg-gray-800 transition-colors">Generate
                            QR Code</button>
                    </div>
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="font-semibold mb-2">Instructions:</h3>
                        <ol class="list-decimal list-inside text-sm text-gray-600 space-y-1">
                            <li>Ensure your class code is correct.</li>
                            <li>The system will use your current location to validate student check-ins.</li>
                            <li>Click "Generate QR Code" to create a unique code for this session.</li>
                        </ol>
                    </div>
                </div>
                <div class="flex flex-col">
                    <div class="flex flex-col items-center mb-8">
                        <h2 class="text-2xl font-bold mb-6">Scan to Mark Attendance</h2>
                        <div
                            class="w-full max-w-sm bg-white p-6 border border-gray-200 rounded-lg shadow-sm flex flex-col items-center">
                            <svg class="w-full h-auto" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M85.714,114.286h-28.571v-28.571h28.571v28.571Z M71.429,100h-14.286v-14.286h14.286v14.286Z M142.857,114.286h-28.571v-28.571h28.571v28.571Z M128.571,100h-14.286v-14.286h14.286v14.286Z M85.714,57.143h-28.571v-28.571h28.571v28.571Z M71.429,42.857h-14.286v-14.286h14.286v14.286Z M171.429,171.429h-14.286v-14.286h-14.286v-14.286h-14.286v-14.286h14.286v-14.286h14.286v-14.286h14.286v14.286h14.286v14.286h-14.286v14.286h14.286v14.286h-14.286v14.286Z M185.714,85.714h-14.286v-14.286h-14.286v-14.286h-14.286v-14.286h-14.286v-14.286h-14.286v14.286h-14.286v14.286h14.286v14.286h14.286v-14.286h14.286v14.286h14.286v14.286h14.286v-14.286h14.286v-14.286h-14.286v-14.286h-14.286v-14.286h14.286v-14.286h14.286v28.571Z M57.143,185.714h-14.286v-14.286h-14.286v-14.286h-14.286v-14.286h-14.286v57.143h57.143v-14.286Z M28.571,171.429h-14.286v-28.571h14.286v28.571Z M14.286,57.143h14.286v-14.286h14.286v-14.286h14.286v-14.286h-57.143v57.143h14.286v-14.286Z M28.571,28.571h-14.286v-14.286h14.286v14.286Z M185.714,14.286v57.143h-14.286v-57.143h14.286Z"
                                    fill="#000000"></path>
                            </svg>
                            <div class="mt-4 text-center">
                                <p class="text-lg font-medium">Expires in: 10 min</p>
                                <p class="text-gray-600 mt-1">Class: MATH101</p>
                            </div>
                        </div>
                    </div>
                    <div class="border border-gray-200 rounded-lg shadow-sm">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-2xl font-bold">Student List</h2>
                            <p class="text-sm text-gray-500 mt-1">Real-time attendance status for your class.</p>
                            <div class="mt-4 flex flex-col sm:flex-row gap-4">
                                <div class="relative flex-grow">
                                    <span
                                        class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">search</span>
                                    <input
                                        class="w-full pl-10 pr-4 py-2 border-gray-300 rounded-md shadow-sm focus:ring-black focus:border-black sm:text-sm"
                                        id="student-search" placeholder="Search student name..." type="text" />
                                </div>
                                <div class="relative">
                                    <select
                                        class="appearance-none w-full sm:w-auto bg-white border-gray-300 rounded-md shadow-sm pl-3 pr-10 py-2 text-left focus:outline-none focus:ring-1 focus:ring-black focus:border-black sm:text-sm">
                                        <option>All Statuses</option>
                                        <option>Checked In</option>
                                        <option>Absent</option>
                                        <option>Late</option>
                                    </select>
                                    <span
                                        class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">expand_more</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 max-h-[28rem] overflow-y-auto">
                            <ul class="divide-y divide-gray-200">
                                <li class="p-4 flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">Alice Johnson</p>
                                        <p class="text-sm text-gray-500">Checked in at: 10:02 AM</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Checked
                                            In</span>
                                        <span class="material-symbols-outlined text-green-500">check_circle</span>
                                    </div>
                                </li>
                                <li class="p-4 flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">Bob Williams</p>
                                        <p class="text-sm text-gray-500">Checked in at: 10:03 AM</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Checked
                                            In</span>
                                        <span class="material-symbols-outlined text-green-500">check_circle</span>
                                    </div>
                                </li>
                                <li class="p-4 flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">Charlie Brown</p>
                                        <p class="text-sm text-gray-500">Checked in at: 10:03 AM</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Checked
                                            In</span>
                                        <span class="material-symbols-outlined text-green-500">check_circle</span>
                                    </div>
                                </li>
                                <li class="p-4 flex justify-between items-center">
                                    <div class="flex-grow">
                                        <p class="font-medium">Diana Prince</p>
                                        <p class="text-sm text-gray-500">Status: Absent</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button
                                            class="text-xs font-medium text-white bg-black hover:bg-gray-800 px-3 py-1.5 rounded-md">Mark
                                            Present</button>
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Absent</span>
                                        <span class="material-symbols-outlined text-red-500">cancel</span>
                                    </div>
                                </li>
                                <li class="p-4 flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">Ethan Hunt</p>
                                        <p class="text-sm text-gray-500">Checked in at: 10:16 AM (Late)</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Late</span>
                                        <span class="material-symbols-outlined text-yellow-500">schedule</span>
                                    </div>
                                </li>
                                <li class="p-4 flex justify-between items-center">
                                    <div class="flex-grow">
                                        <p class="font-medium">Fiona Glenanne</p>
                                        <p class="text-sm text-gray-500">Status: Absent</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button
                                            class="text-xs font-medium text-white bg-black hover:bg-gray-800 px-3 py-1.5 rounded-md">Mark
                                            Present</button>
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Absent</span>
                                        <span class="material-symbols-outlined text-red-500">cancel</span>
                                    </div>
                                </li>
                                <li class="p-4 flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">George Costanza</p>
                                        <p class="text-sm text-gray-500">Checked in at: 10:01 AM</p>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Checked
                                            In</span>
                                        <span class="material-symbols-outlined text-green-500">check_circle</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="p-6 border-t border-gray-200">
                            <h3 class="text-lg font-bold mb-4">Manual Attendance</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700"
                                        for="manual-student-name">Student Name</label>
                                    <input
                                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-black focus:border-black sm:text-sm"
                                        id="manual-student-name" placeholder="e.g., Jane Doe" type="text" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700"
                                        for="manual-status">Status</label>
                                    <select
                                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-black focus:border-black sm:text-sm"
                                        id="manual-status">
                                        <option>Present</option>
                                        <option>Late</option>
                                        <option>Absent</option>
                                    </select>
                                </div>
                                <button
                                    class="w-full bg-black text-white font-bold py-2 px-4 rounded-md hover:bg-gray-800 transition-colors">Add
                                    Entry</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/teacher.js"></script>
    <script type="module" src="js/student.js"></script>\
    <script type="module" src="js/firebase.js"></script>
    <script type="module" src="js/api.js"></script>
    <!-- QRCode.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
        const qrBtn = document.querySelector("button"); // your "Generate QR Code" button
        const qrContainer = document.createElement("div");
        qrContainer.id = "qrcode";
        document.body.appendChild(qrContainer);

        qrBtn.addEventListener("click", () => {
            const classCode = document.getElementById("class-code").value;
            const timestamp = Date.now();

            // Data that will be embedded into QR (class + session + expiry)
            const qrData = JSON.stringify({
                classCode: classCode,
                session: timestamp,
                expires: timestamp + 10 * 60 * 1000 // valid 10 minutes
            });

            qrContainer.innerHTML = ""; // reset
            new QRCode(qrContainer, {
                text: qrData,
                width: 200,
                height: 200
            });

            // Send to backend (FastAPI) so student check-ins can be validated
            fetch("http://127.0.0.1:8000/api/save-session", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: qrData
            }).then(res => console.log("Session saved:", res));
        });
    </script>
</body>

</html>